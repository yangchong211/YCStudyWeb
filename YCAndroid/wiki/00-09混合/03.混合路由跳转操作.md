#### 目录介绍
- 01.Android跳转flutter页面
- 02.Flutter跳转Android页面


### 01.Android跳转flutter页面
- 如何处理Android原生跳转flutter页面
    - 首先原理还是利用MethodChanel 进行native 和 flutter 之间的通讯。
    - 只是这个android 端的Channel就不是new 出来的了，而是使用FlutterEngine类中的getNavigationChannel()获取的。
- 关于Android的跳转flutter代码
    ```
    //获取路由channel通信对象
    navigationChannel = flutterEngine.getNavigationChannel();
    String route = "yc?{\"name\":\"杨充\"}";
    //设置初始化路由
    navigationChannel.setInitialRoute(route);
    ```
- flutter处理Android跳转
    - 注意：从android 跳转过来的flutter页面，必须使用MaterialApp 作为根布局，否则会报错。
    ```
    void main() => runApp(new MyApp());
    
    class MyApp extends StatelessWidget {
      // This widget is the root of your application.
      @override
      Widget build(BuildContext context) {
        return MaterialApp(
          title: 'flutter和Android混编项目',
          theme: ThemeData(
            primarySwatch: Colors.blue,
          ),
          home: widgetForRoute(window),
        );
      }
    
      static const String HOME_PATH = "/home_page";
    
      static Map<String, dynamic> parseRouter(Window window){
        // window.defaultRouteName就是获取Android传递过来的参数
        // 通过这个字段我们就可以进行Flutter页面的路由的分发
        String url = window.defaultRouteName;
        // route名称，路由path路径名称
        String route = url.indexOf('?') == -1 ? url : url.substring(0, url.indexOf('?'));
        // 参数Json字符串
        String paramsJson = url.indexOf('?') == -1 ? '{}' : url.substring(url.indexOf('?') + 1);
        // 解析参数
        Map<String, dynamic> params = json.decode(paramsJson);
        print('path---->' + route + " " + params.toString());
        params["route"] = route;
        return params;
      }
    
    
      static Widget widgetForRoute(Window window) {
        Map<String, dynamic> router = parseRouter(window);
        var route = router["route"];
        switch (route) {
          case 'yc_route':
            return  MyHomePage(title: '匹配到了，这个是flutter页面');
          case 'yc':
            return AboutMePage(title: '匹配到了，这个是flutter页面',params : router);
          case 'router_channel':
          //混合路由跳转
            return RouterChannelPage(title: '匹配到，测试NA和Flutter相互跳转');
          default:
            return  MyHomePage(title: '没有匹配到哈，查看route是否一致1');
        }
      }
    }
    ```


### 02.Flutter跳转Android页面
- 首先看一下flutter执行跳转代码
    - 这个频道名称是不能改的，必须设置为"flutter/navigation"。因为flutterEngine的NavigationChanel的构造方法是这么写的。
    ```
    //这个频道名称是不能改的，必须设置为"flutter/navigation"。因为flutterEngine的NavigationChanel的构造方法是这么写的
    static const method1 = const MethodChannel('flutter/navigation');
  
    Future<Null> _jumpToNativeWithParams1() async {
        Map<String, String> map = new Map();
        //这个是原生页面的路由地址，一定要传递
        map["router"] = "main/me";
        map["flutter"] = "这是一条来自flutter的参数";
        //Map<String, String> map = { "flutter": "这是一条来自flutter的参数" };
        String result = await method1.invokeMethod('android', map);
        print(result);
    }
    ```
- 然后看一下Android监听flutter事件代码
    ```
    navigationChannel.setMethodCallHandler(new MethodChannel.MethodCallHandler() {
        @Override
        public void onMethodCall(@NonNull MethodCall methodCall, @NonNull MethodChannel.Result result) {
            String method = methodCall.method;
            Log.i("onMethodCall","---"+method);
            if ("android".equals(method)) {
                //接收来自flutter的指令
                //解析参数
                String router = methodCall.argument("router");
                Object text = methodCall.argument("flutter");
                if (router==null || router.length()==0){
                    Toast.makeText(FlutterViewActivity3.this,
                            "路由地址不能为空",Toast.LENGTH_LONG).show();
                    return;
                }
                if (router.equals("main/me")) {
                    //带参数跳转到指定Activity
                    Intent intent = new Intent(
                            FlutterViewActivity3.this,
                            RouterToNaMeActivity.class);
                    intent.putExtra("yc", (String) text);
                    startActivity(intent);
                } else if (router.equals("main/about")){
                    Intent intent = new Intent(
                            FlutterViewActivity3.this, RouterToNaAboutActivity.class);
                    intent.putStringArrayListExtra("yc", (ArrayList<String>) text);
                    startActivity(intent);
                }
                //返回给flutter的参数
                result.success("Na成功");
            }
        }
    });
    ```
- 使用上面代码执行，发现flutter跳转NA页面，无效，无效，为什么？
    - 首先看下NavigationChannel是如何创建MethodChannel对象的，如下所示，NavigationChannel 的解析对象是JSONMethodCodec
    ```
    public NavigationChannel(@NonNull DartExecutor dartExecutor) {
        this.channel = new MethodChannel(dartExecutor, "flutter/navigation", JSONMethodCodec.INSTANCE);
    }
    ```
    - 然后再看一下flutter代码是如何创建MethodChannel
    ```
    static const method1 = const MethodChannel('flutter/navigation');
    ```
    - 于是看一下MethodChannel创建源码，发现使用StandardMethodCodec()，这个NavigationChannel的编解码器是不一样，导致解析失败。
    ```
    const MethodChannel(this.name, [this.codec = const StandardMethodCodec(), BinaryMessenger binaryMessenger ])
    ```
- 修正MethodChannel创建时一定要保证编解码器相同，使用下面代码即可解决问题
    ```
    static const method1 = const MethodChannel('flutter/navigation',JSONMethodCodec());
    ```






















